/*
 * -------------------------------------------------
 *  University of Cape Town HPC cluster config file (Tychus Assembly module)
 * -------------------------------------------------
 * http://hpc.uct.ac.za/db/
 */

singularity {
   enabled = true
   cacheDir = "/scratch/DB/bio/singularity-containers" //KL need to create on HPC
}

env {
TRIMMOMATIC='/opt/Trimmomatic-0.36' //KL specify Trimmomatic location in singularity image
}

process {
   container = "/scratch/DB/bio/singularity-containers/769bd43d8bc4-2019-03-04-4d3032297a78.img"
   executor = 'pbs'
   stageInMode = 'symlink'
   stageOutMode = 'rsync'
   queue = 'UCTlong' //KL new queue name on HPC?
   clusterOptions = { "-M $params.email -m abe" }

   // Increasing maxRetries, this will overwrite what we have in base.config
   maxRetries = 4
}

executor{
   jobName = { "$task.tag" }
   queueSize = 20
}

params {
   max_memory = 256.GB
   max_cpus = 64
   max_time = 1000.h
}

// Capture exit codes from upstream processes when piping
process.shell = ['/bin/bash', '-euo', 'pipefail']

timeline {
  enabled = true
  file = "${params.assembly_out_dir}/pipeline_info/Tychus_assembly_timeline.html"
}
report {
  enabled = true
  file = "${params.assembly_out_dir}/pipeline_info/Tychus_assembly_report.html"
}
trace {
  enabled = true
  file = "${params.assembly_out_dir}/pipeline_info/Tychus_assembly_trace.txt"
}
dag {
  enabled = true
  file = "${params.assembly_out_dir}/pipeline_info/Tychus_assembly_DAG.svg"
}
